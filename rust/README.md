# Rust å…¥é—¨

å‚è€ƒæ–‡æ¡£ï¼š

- https://www.rust-lang.org/zh-CN/
- https://kaisery.gitbooks.io/rust-book-chinese/content/

## å®‰è£…

```shell
curl https://sh.rustup.rs -sSf | sh
```

åœ¨ Rust å¼€å‘ç¯å¢ƒä¸­ï¼Œæ‰€æœ‰å·¥å…·éƒ½å®‰è£…åˆ° ~/.cargo/bin ç›®å½•ï¼Œ å¹¶ä¸”æ‚¨èƒ½å¤Ÿåœ¨è¿™é‡Œæ‰¾åˆ° Rust å·¥å…·é“¾ï¼ŒåŒ…æ‹¬ rustcã€cargo åŠ rustupã€‚

## å¯¼å…¥ç¯å¢ƒå˜é‡

```shell
source ~/.cargo/env
```

## å¸è½½

```shell
rustup self uninstall
```

## æ˜¾ç¤ºç‰ˆæœ¬å·

```shell
rustc --version
```

## åˆ›å»ºæ–‡ä»¶ `hello_world.rs`

```rust
fn main() {
    println!("Hello, world!"); // å¸¦æœ‰ å¹å·ï¼Œè¡¨ç¤ºæ˜¯Rustå®å®šä¹‰
}
```

Rustæ˜¯ä¸€é—¨é¢å‘è¡¨è¾¾å¼çš„è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯è¯´å¤§éƒ¨åˆ†è¯­å¥éƒ½æ˜¯è¡¨è¾¾å¼ã€‚`;`è¡¨ç¤ºä¸€ä¸ªè¡¨è¾¾å¼çš„ç»“æŸï¼Œå¦ä¸€ä¸ªæ–°è¡¨è¾¾å¼çš„å¼€å§‹ã€‚å¤§éƒ¨åˆ† Rust ä»£ç è¡Œä»¥`;`ç»“å°¾ã€‚

### ç¼–è¯‘ `hello_world.rs`

```shell
rustc hello_world.rs
```

ä¼šç”Ÿæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ `hello_world`

### è¿è¡Œ

```shell
./hello_world
```

## è®¾å®šç¯å¢ƒå˜é‡è·å– backtrace

```shell
export RUST_BACKTRACE=1
# or
RUST_BACKTRACE=1 ./hello_world
RUST_BACKTRACE=1 cargo run
```

# ä½¿ç”¨ Cargo

ä»…ä»…ä½¿ç”¨ rustc ç¼–è¯‘ç®€å•ç¨‹åºæ˜¯æ²¡é—®é¢˜çš„ï¼Œä¸è¿‡éšç€ä½ çš„é¡¹ç›®çš„å¢é•¿ï¼Œä½ å°†æƒ³è¦èƒ½å¤Ÿæ§åˆ¶ä½ é¡¹ç›®æ‹¥æœ‰çš„æ‰€æœ‰é€‰é¡¹ï¼Œå¹¶æ˜“äºåˆ†äº«ä½ çš„ä»£ç ç»™åˆ«äººæˆ–åˆ«çš„é¡¹ç›®ã€‚

Cargo æ˜¯ Rust çš„æ„å»ºç³»ç»Ÿå’ŒåŒ…ç®¡ç†å·¥å…·ï¼ŒCargo è´Ÿè´£ä¸‰ä¸ªå·¥ä½œï¼š
- æ„å»ºä»£ç 
- ä¸‹è½½ä»£ç ä¾èµ–åº“ï¼Œæˆ‘ä»¬æŠŠä½ ä»£ç éœ€è¦çš„åº“å«åšâ€œä¾èµ–ï¼ˆdependenciesï¼‰â€å› ä¸ºä½ çš„ä»£ç ä¾èµ–ä»–ä»¬ã€‚
- ç¼–è¯‘åº“

## æŸ¥çœ‹ Cargo ç‰ˆæœ¬å·

```shell
cargo --version
```

## Cargo åŒ…ç®¡ç†

Rust åŒ…ç®¡ç†ä½¿ç”¨ crate æ ¼å¼çš„å‹ç¼©åŒ…å­˜å‚¨å’Œå‘å¸ƒåº“ï¼Œå®˜æ–¹æœ‰ä¸€ä¸ªé›†ä¸­å¼çš„ä»“åº“ã€‚
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å›½å†…çš„ä»“åº“é•œåƒåœ°å€ï¼Œä½¿ç”¨é•œåƒåªéœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª `.cargo/config` æ–‡ä»¶ï¼Œå¹¶åœ¨å…¶ä¸­åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š

```config
[registry]
index = "git://crates.mirrors.ustc.edu.cn/index"
```

## å°†ä¹‹å‰é¡¹ç›®è½¬æ¢åˆ° Cargo

è®©æˆ‘ä»¬å°† Hello World ç¨‹åºè¿ç§»è‡³ Cargoï¼Œç°åœ¨éœ€è¦åšä¸‰ä»¶äº‹ï¼š

- å°†æºæ–‡ä»¶æ”¾åˆ°æ­£ç¡®çš„ç›®å½•
- åˆ›å»ºä¸€ä¸ª Cargo é…ç½®æ–‡ä»¶

### æºæ–‡ä»¶ç›®å½•

```shell
mkdir hello_world2/src
cp hello_world.rs hello_world2/src/
```

### åˆ›å»ºé…ç½®æ–‡ä»¶ `Cargo.toml`

```toml
[package]
name = "hello_world"
version = "0.0.1"
authors = [ "dreamsxin <dreamsxin@qq.com>" ]

[[bin]]
name = "hello_world"
path = "src/hello_world.rs
```

ç¬¬ä¸€è¡Œï¼Œ`[package]`ï¼Œè¡¨æ˜ä¸‹é¢çš„è¯­å¥ç”¨æ¥é…ç½®ä¸€ä¸ªåŒ…ã€‚
å¦å¤–ä¸‰è¡Œè®¾ç½®äº† Cargo ç¼–è¯‘ä½ çš„ç¨‹åºæ‰€éœ€è¦çŸ¥é“çš„ä¸‰ä¸ªé…ç½®ï¼šåŒ…çš„åå­—ï¼Œç‰ˆæœ¬ï¼Œå’Œä½œè€…ã€‚
å¦‚æœæºæ–‡ä»¶åä¸º `main.rs` åˆ™ `[[bin]]` ä¸éœ€è¦é…ç½®ã€‚

### æ„å»ºå¹¶è¿è¡Œä¸€ä¸ª Cargo é¡¹ç›®

å½“Cargo.tomlæ–‡ä»¶ä½äºé¡¹ç›®çš„æ ¹ç›®å½•æ—¶ï¼Œæˆ‘ä»¬å°±å‡†å¤‡å¥½å¯ä»¥æ„å»ºå¹¶è¿è¡Œ Hello World ç¨‹åºäº†ï¼

```shell
cd hello_world2/
cargo build
```

ç¬¬ä¸€æ¬¡æ„å»ºä¼šä¸‹è½½ä¾èµ–åº“ï¼Œå­˜æ”¾åœ¨ç›®å½• `~/.cargo/registry/`ã€‚
æ‰§è¡ŒæˆåŠŸåï¼Œä¼šç”Ÿæˆæ–‡ä»¶ `./target/debug/hello_world`

### å‘å¸ƒæ„å»ºï¼ˆBuilding for Releaseï¼‰

å½“ä½ çš„é¡¹ç›®å‡†å¤‡å¥½å‘å¸ƒäº†ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥ä¼˜åŒ–ç¼–è¯‘é¡¹ç›®ã€‚

```shell
cargo build --release
````

è¿™äº›ä¼˜åŒ–å¯ä»¥è®© Rust ä»£ç è¿è¡Œçš„æ›´å¿«ï¼Œä¸è¿‡å¯ç”¨ä»–ä»¬ä¼šè®©ç¨‹åºèŠ±æ›´é•¿çš„æ—¶é—´ç¼–è¯‘ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä½•è¿™æ˜¯ä¸¤ç§ä¸åŒçš„é…ç½®ï¼Œä¸€ä¸ªä¸ºäº†å¼€å‘ï¼Œå¦ä¸€ä¸ªæ„å»ºæä¾›ç»™ç”¨æˆ·çš„æœ€ç»ˆç¨‹åºã€‚

### è¿è¡Œ

```shell
cargo run
```

### åˆ›å»ºæ–° Cargo é¡¹ç›®çš„ç®€å•æ–¹æ³•

```shell
cargo new hello_world --bin
```

è¿™ä¸ªå‘½ä»¤ä¼ é€’äº†`--bin`å‚æ•°å› ä¸ºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç›´æ¥åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåº“ã€‚
Cargo ä¸ºæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªæ–‡ä»¶å’Œä¸€ä¸ªç›®å½•ï¼šä¸€ä¸ªCargo.tomlå’Œä¸€ä¸ªåŒ…å«äº† `main.rs` æ–‡ä»¶çš„ `src` ç›®å½•ã€‚

### æ¸…ç†

```shell
cargo clean
```

## ä½¿ç”¨ Cargo åˆ›å»ºçŒœæ•°å­—æ¸¸æˆ

```shell
cargo new guessing_game --bin
```

è¿™ä¸ªå‘½ä»¤ä¼ é€’äº†`--bin`å‚æ•°å› ä¸ºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯ç›´æ¥åˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œç¨‹åºï¼Œè€Œä¸æ˜¯ä¸€ä¸ªåº“ã€‚
Cargo ä¸ºæˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ªâ€œHello, world!â€ã€‚æŸ¥çœ‹src/main.rsæ–‡ä»¶ï¼š
```rust
fn main() {
    println!("Hello, world!");
}
```

### å¼•å…¥éšæœºåº“

åœ¨æ–‡ä»¶ `Cargo.toml` å¢åŠ ï¼š
```toml
[dependencies]
rand="*"
```

æ˜Ÿå· `*` ä»£è¡¨æœ€æ–°ç‰ˆæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šç‰ˆæœ¬ rand="0.3"ã€‚

### ç¼–å†™ä»£ç 

```rust
// åœ¨[dependencies]å£°æ˜äº†randï¼Œè¿™é‡Œç”¨extern crateæ¥è®©RustçŸ¥é“æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨å®ƒ
extern crate rand;

use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!("Guess the number!");

    let secret_number = rand::thread_rng().gen_range(1, 101);

    println!("The secret number is: {}", secret_number);

    println!("Please input your guess.");

	// åˆ›å»ºä¸€ä¸ªåœ°æ–¹å‚¨å­˜ç”¨æˆ·è¾“å…¥
    let mut guess = String::new();

    // ç»ˆç«¯æ ‡å‡†è¾“å…¥å¥æŸ„è·å–ç”¨æˆ·è¾“å…¥
    io::stdin().read_line(&mut guess).expect("failed to read line");

    println!("You guessed: {}", guess);

    match guess.cmp(&secret_number) {
        Ordering::Less    => println!("Too small!"),
        Ordering::Greater => println!("Too big!"),
        Ordering::Equal   => println!("You win!"),
    }
}
```

* å¦‚æœæ— æ³•é€šè¿‡ Cargo ä¸‹è½½åŒ…ï¼Œå¯ä»¥ä½¿ç”¨ä»£ç†

```shell
export http_proxy="http://127.0.0.1:8787";
export HTTPS_PROXY="https://127.0.0.1:8787/";
export FTP_PROXY=ftp://127.0.0.1:8787/";
```

æˆ–è€…é…ç½® `.cargo/config`

```conf
[http]
proxy = "127.0.0.1:8787"  # HTTP proxy to use for HTTP requests (defaults to none)
timeout = 60000      # Timeout for each HTTP request, in milliseconds

# or
[http]
proxy = "http://127.0.0.1:8787/"

[https]
proxy = "https://127.0.0.1:8787/"
```

æˆ‘ä»¬å¯ä»¥é€šè¿‡ `cargo build --verbose` çœ‹ä¸‹æœ€åæ‰§è¡Œçš„å‘½ä»¤ï¼š
```shell
rustc src/main.rs --crate-name guessing_game --crate-type bin -g
	--out-dir /home/zhuzx/work/example/rust/guessing_game/target/debug
	--emit=dep-info,link
	-L dependency=/home/zhuzx/work/example/rust/guessing_game/target/debug
	-L dependency=/home/zhuzx/work/example/rust/guessing_game/target/debug/deps
	--extern rand=/home/zhuzx/work/example/rust/guessing_game/target/debug/deps/librand-49a08859d086fffe.rlib`
```

# è¯­æ³•è¯­ä¹‰

## å˜é‡ç»‘å®š

let è¢«ç”¨æ¥å£°æ˜ä¸€ä¸ªç»‘å®šï¼Œä»–ä»¬å°†ä¸€äº›å€¼ç»‘å®šåˆ°ä¸€ä¸ªåå­—ä¸Šï¼Œè¿™æ ·å¯ä»¥åœ¨ä¹‹åä½¿ç”¨ä»–ä»¬ã€‚

```rust
fn main() {
    let x = 5;
}
```

### æ¨¡å¼ï¼ˆPatternsï¼‰

let è¯­å¥çš„å·¦ä¾§æ˜¯ä¸€ä¸ªâ€œæ¨¡å¼â€ï¼Œè€Œä¸ä»…ä»…æ˜¯ä¸€ä¸ªå˜é‡ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬å¯ä»¥è¿™æ ·å†™ï¼š

```rust
let (x, y) = (1, 2);
```

åœ¨è¿™ä¸ªè¯­å¥è¢«è®¡ç®—åï¼Œxå°†ä¼šæ˜¯1ï¼Œè€Œyå°†ä¼šæ˜¯2ã€‚

### ç±»å‹æ³¨è§£ï¼ˆType annotationsï¼‰

Rust æ˜¯ä¸€ä¸ªé™æ€ç±»å‹è¯­è¨€ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬éœ€è¦å…ˆç¡®å®šæˆ‘ä»¬éœ€è¦çš„ç±»å‹ã€‚
Rust æœ‰ä¸€ä¸ªå«åšç±»å‹æ¨æ–­çš„åŠŸèƒ½ã€‚å¦‚æœå®ƒèƒ½ç¡®è®¤è¿™æ˜¯ä»€ä¹ˆç±»å‹ï¼ŒRust ä¸éœ€è¦ä½ æ˜ç¡®åœ°æŒ‡å‡ºæ¥ã€‚

è‹¥ä½ æ„¿æ„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åŠ ä¸Šç±»å‹ã€‚ç±»å‹å†™åœ¨ä¸€ä¸ªå†’å·`:`åé¢ï¼š

```rust
let x: i32 = 5;
```

å¯ä»¥æè¿°ä¸ºâ€œxè¢«ç»‘å®šä¸ºi32ç±»å‹ï¼Œå®ƒçš„å€¼æ˜¯5â€ã€‚
Rust æœ‰è®¸å¤šä¸åŒçš„åŸç”Ÿæ•´æ•°ç±»å‹ï¼š
- i ä»£è¡¨æœ‰ç¬¦å·æ•´æ•°
- u ä»£è¡¨æ— ç¬¦å·æ•´æ•°ã€‚

å¯èƒ½çš„æ•´æ•°å¤§å°æœ‰ 8ã€16ã€32 å’Œ 64 ä½ã€‚

### å¯å˜æ€§

å˜é‡é»˜è®¤æ˜¯ä¸å¯å˜ï¼ˆimmutableï¼‰çš„ã€‚
å½“å˜é‡ä¸å¯å˜æ—¶ï¼Œæ„å‘³ç€ä¸€æ—¦å€¼è¢«ç»‘å®šä¸Šä¸€ä¸ªåç§°ï¼Œä½ å°±ä¸èƒ½æ”¹å˜è¿™ä¸ªå€¼ã€‚å¯ä»¥é€šè¿‡åœ¨å˜é‡åä¹‹å‰åŠ  `mut` æ¥ä½¿å…¶å¯å˜ã€‚
æ³¨æ„å’Œä¸‹é¢å˜é‡çš„è¦†ç›–ï¼ˆShadowingï¼‰åšåŒºåˆ«ã€‚

åˆ›å»ºæ–‡ä»¶ `variables.rs`ï¼š

```rust
fn main() {
    let x = 5;
    println!("The value of x is: {}", x);
    x = 6;
    println!("The value of x is: {}", x);
}
```

è¿è¡Œå°†ä¼šæŠ¥é”™ re-assignment of immutable variable `x`ã€‚

è¿™é‡Œ `println!` è¾“å‡ºçš„å­—ç¬¦ä¸²ä¸­åŒ…å«ä¸€å¯¹å¤§æ‹¬å·`{}`ï¼ŒRustå°†æŠŠå®ƒè§£é‡Šä¸ºæ’å…¥å€¼çš„è¯·æ±‚ã€‚å½“ä½ åªå†™äº†å¤§æ‹¬å·çš„æ—¶å€™ï¼ŒRust ä¼šå°è¯•æ£€æŸ¥å€¼çš„ç±»å‹æ¥æ˜¾ç¤ºä¸€ä¸ªæœ‰æ„ä¹‰çš„å€¼ã€‚
æ›´å¤šçš„é€‰é¡¹ï¼ŒæŸ¥çœ‹æ–‡æ¡£ https://doc.rust-lang.org/std/fmt/ã€‚

`println!` æ˜¯ Rust çš„å®ï¼Œåªè¦æ˜¯çœ‹åˆ°äº†å¹å·`!`ï¼Œå°±æ˜¯ä¸€ä¸ªä»£æ›¿æ™®é€šå‡½æ•°çš„å®ã€‚

```rust
macro_rules! println {
    () => { ... };
    ($fmt:expr) => { ... };
    ($fmt:expr, $($arg:tt)*) => { ... };
}
```

### åˆå§‹åŒ–ç»‘å®š

Rust å˜é‡ç»‘å®šè¦æ±‚åœ¨å¯ä»¥ä½¿ç”¨å®ƒä¹‹å‰å¿…é¡»åˆå§‹åŒ–ï¼ŒRust æ˜¯ä¸ä¼šè®©æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªæ²¡æœ‰ç»è¿‡åˆå§‹åŒ–çš„å€¼çš„ã€‚

### ä½œç”¨åŸŸï¼ˆScopeï¼‰

å˜é‡ç»‘å®šæœ‰ä¸€ä¸ªä½œç”¨åŸŸ - ä»–ä»¬è¢«é™åˆ¶åªèƒ½åœ¨ä»–ä»¬è¢«å®šä¹‰çš„å—ä¸­å­˜åœ¨ã€‚ä¸€ä¸ªå—æ˜¯ä¸€ä¸ªè¢«å¤§æ‹¬å·`{`å’Œ`}`åŒ…å›´çš„è¯­å¥é›†åˆã€‚å‡½æ•°å®šä¹‰ä¹Ÿæ˜¯å—ã€‚

```rust
fn main() {
    let x: i32 = 17;
    {
        let y: i32 = 3;
        println!("The value of x is {} and value of y is {}", x, y);
    }
	// ä¸èƒ½è®¿é—® y å€¼ï¼Œå› ä¸ºå®ƒå·²ä¸åœ¨ä½œç”¨åŸŸä¸­
    println!("The value of x is {} and value of y is {}", x, y); // This won't work.
}
```

### å˜é‡çš„é®ç›–ï¼ˆShadowingï¼‰

å˜é‡å¯ä»¥é‡å¤ä½¿ç”¨ let å…³é”®å­—è¿›è¡Œå¤šæ¬¡é®ç›–ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªåå£°æ˜çš„å¹¶ä½äºåŒä¸€ä½œç”¨åŸŸçš„ç›¸åŒåå­—çš„å˜é‡ç»‘å®šå°†ä¼šè¦†ç›–å‰ä¸€ä¸ªå˜é‡ç»‘å®šï¼š

```rust
let x: i32 = 8;
{
    println!("{}", x); // Prints "8".
    let x = 12;
    println!("{}", x); // Prints "12".
}
println!("{}", x); // Prints "8".
let x =  42;
println!("{}", x); // Prints "42".
```

éšè—å’Œå¯å˜ç»‘å®šå¯èƒ½è¡¨ç°ä¸ºåŒä¸€æšç¡¬å¸çš„ä¸¤é¢ï¼Œä»–ä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µï¼Œä¸èƒ½äº’æ¢ä½¿ç”¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œéšè—å…è®¸æˆ‘ä»¬å°†ä¸€ä¸ªåå­—é‡ç»‘å®šä¸ºä¸åŒçš„ç±»å‹ã€‚å®ƒä¹Ÿå¯ä»¥æ”¹å˜ä¸€ä¸ªç»‘å®šçš„å¯å˜æ€§ã€‚
æ³¨æ„éšè—å¹¶ä¸æ”¹å˜å’Œé”€æ¯è¢«ç»‘å®šçš„å€¼ï¼Œè¿™ä¸ªå€¼ä¼šåœ¨ç¦»å¼€ä½œç”¨åŸŸä¹‹å‰ç»§ç»­å­˜åœ¨ï¼Œå³ä¾¿æ— æ³•é€šè¿‡ä»»ä½•æ‰‹æ®µè®¿é—®åˆ°å®ƒã€‚

```rust
let mut x: i32 = 1;
x = 7;
let x = x; // `x` is now immutable and is bound to `7`

let y = 4;
let y = "I can also be bound to text!"; // `y` is now of a different type
```

### å˜é‡å’Œå¸¸é‡çš„åŒºåˆ«

ä¸å…è®¸å¯¹å¸¸é‡ä½¿ç”¨ mutï¼šå¸¸é‡ä¸å…‰é»˜è®¤ä¸èƒ½å˜ï¼Œå®ƒæ€»æ˜¯ä¸èƒ½å˜ã€‚
å£°æ˜å¸¸é‡ä½¿ç”¨ const å…³é”®å­—è€Œä¸æ˜¯ letï¼Œè€Œä¸”å¿…é¡»æ³¨æ˜å€¼çš„ç±»å‹ã€‚
å¸¸é‡å¯ä»¥åœ¨ä»»ä½•ä½œç”¨åŸŸå£°æ˜ï¼ŒåŒ…æ‹¬å…¨å±€ä½œç”¨åŸŸï¼Œè¿™åœ¨ä¸€ä¸ªå€¼éœ€è¦è¢«å¾ˆå¤šéƒ¨åˆ†çš„ä»£ç ç”¨åˆ°æ—¶å¾ˆæœ‰ç”¨ã€‚
å¸¸é‡åªèƒ½ç”¨äºå¸¸é‡è¡¨è¾¾å¼ï¼Œè€Œä¸èƒ½ä½œä¸ºå‡½æ•°è°ƒç”¨çš„ç»“æœï¼Œæˆ–ä»»ä½•å…¶ä»–åªåœ¨è¿è¡Œæ—¶è®¡ç®—çš„å€¼ã€‚

ä¸€ä¸ªå¸¸é‡å£°æ˜çš„ä¾‹å­ï¼Œå®ƒçš„åç§°æ˜¯ MAX_POINTSï¼Œå€¼æ˜¯ 100,000ã€‚ï¼ˆå¸¸é‡ä½¿ç”¨ä¸‹åˆ’çº¿åˆ†éš”çš„å¤§å†™å­—æ¯å‘½åï¼‰ï¼š
```rust
const MAX_POINTS: u32 = 100_000;
```

## æ•°æ®ç±»å‹

åœ¨ Rust ä¸­ï¼Œä»»ä½•å€¼éƒ½å±äºä¸€ç§æ˜ç¡®çš„ç±»å‹ï¼ˆtypeï¼‰ï¼Œå£°æ˜å®ƒè¢«æŒ‡å®šäº†ä½•ç§æ•°æ®ï¼Œä»¥ä¾¿æ˜ç¡®å…¶å¤„ç†æ–¹å¼ã€‚æˆ‘ä»¬å°†åˆ†ä¸¤éƒ¨åˆ†æ¢è®¨ä¸€äº›å†…å»ºç±»å‹ï¼šæ ‡é‡ï¼ˆscalarï¼‰å’Œå¤åˆï¼ˆcompoundï¼‰ã€‚

### æ ‡é‡ï¼ˆscalarï¼‰

æ ‡é‡ç±»å‹ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„å€¼ã€‚Rust æœ‰å››ç§åŸºæœ¬çš„æ ‡é‡ç±»å‹ï¼šæ•´å‹ã€æµ®ç‚¹å‹ã€å¸ƒå°”ç±»å‹å’Œå­—ç¬¦ç±»å‹ã€‚

#### æ•°å­—ç±»å‹

Rustæœ‰ä¸€äº›åˆ†ç±»çš„å¤§é‡æ•°å­—ç±»å‹ï¼šæœ‰ç¬¦å·å’Œæ— ç¬¦å·ï¼Œå®šé•¿å’Œå˜é•¿ï¼Œæµ®ç‚¹å’Œæ•´å‹ã€‚

* æ•´å‹

æ•´æ•°æ˜¯ä¸€ä¸ªæ²¡æœ‰å°æ•°éƒ¨åˆ†çš„æ•°å­—ã€‚

- i ä»£è¡¨æœ‰ç¬¦å·æ•´æ•°ï¼Œæœ‰ç¬¦å·æ•°ä»¥äºŒè¿›åˆ¶è¡¥ç å½¢å¼ï¼ˆtwoâ€™s complement representationï¼‰å­˜å‚¨ã€‚
- u ä»£è¡¨æ— ç¬¦å·æ•´æ•°ã€‚

å¯èƒ½çš„æ•´æ•°å¤§å°æœ‰ 8ã€16ã€32 å’Œ 64 ä½ã€‚

æ¯ä¸€ä¸ªæœ‰ç¬¦å·çš„å˜ä½“å¯ä»¥å‚¨å­˜åŒ…å«ä» -(2n - 1) åˆ° 2n - 1 - 1 åœ¨å†…çš„æ•°å­—ï¼Œè¿™é‡Œ n æ˜¯å˜ä½“ä½¿ç”¨çš„ä½æ•°ã€‚æ‰€ä»¥ i8 å¯ä»¥å‚¨å­˜ä» -(27) åˆ° 27 - 1 åœ¨å†…çš„æ•°å­—ï¼Œä¹Ÿå°±æ˜¯ä» -128 åˆ° 127ã€‚æ— ç¬¦å·çš„å˜ä½“å¯ä»¥å‚¨å­˜ä» 0 åˆ° 2n - 1 çš„æ•°å­—ï¼Œæ‰€ä»¥ u8 å¯ä»¥å‚¨å­˜ä» 0 åˆ° 28 - 1 çš„æ•°å­—ï¼Œä¹Ÿå°±æ˜¯ä» 0 åˆ° 255ã€‚

* æµ®ç‚¹å‹

æœ‰ä¸¤ä¸ªä¸»è¦çš„æµ®ç‚¹æ•°ç±»å‹ï¼Œf32 å’Œ f64ï¼Œå®ƒä»¬å¯¹åº” IEEE-754 å•ç²¾åº¦å’ŒåŒç²¾åº¦æµ®ç‚¹æ•°ã€‚åˆ†åˆ«å  32 ä½å’Œ 64 ä½æ¯”ç‰¹ã€‚é»˜è®¤ç±»å‹æ˜¯ f64ï¼Œå› ä¸ºå®ƒä¸ f32 é€Ÿåº¦å·®ä¸å¤šï¼Œç„¶è€Œç²¾åº¦æ›´é«˜ã€‚
åœ¨ 32 ä½ç³»ç»Ÿä¸Šä¹Ÿèƒ½å¤Ÿä½¿ç”¨ f64ï¼Œä¸è¿‡æ¯”ä½¿ç”¨ f32 è¦æ…¢ã€‚

```rust
fn main() {
    let x = 2.0; // f64

    let y: f32 = 3.0; // f32
}
```

* å¯å˜å¤§å°ç±»å‹

Rust ä¹Ÿæä¾›äº†ä¾èµ–åº•å±‚æœºå™¨æŒ‡é’ˆå¤§å°çš„ç±»å‹ã€‚è¿™äº›ç±»å‹æ‹¥æœ‰â€œsizeâ€åˆ†ç±»ï¼Œå¹¶æœ‰æœ‰ç¬¦å·å’Œæ— ç¬¦å·å˜ä½“ã€‚å®ƒæœ‰ä¸¤ä¸ªç±»å‹ï¼šisizeå’Œusizeã€‚

* å¸ƒå°”å‹

æœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼štrueå’Œfalseã€‚Rust ä¸­çš„å¸ƒå°”ç±»å‹ä½¿ç”¨boolè¡¨ç¤ºã€‚ä¾‹å¦‚ï¼š

```rust
fn main() {
    let t = true;

    let f: bool = false; // with explicit type annotation
}
```

* å­—ç¬¦ç±»å‹

charç±»å‹ä»£è¡¨ä¸€ä¸ªå•ç‹¬çš„ Unicode å­—ç¬¦çš„å€¼ã€‚ä½ å¯ä»¥ç”¨å•å¼•å·ï¼ˆ'ï¼‰åˆ›å»º `char`ï¼Œä¸åƒå…¶å®ƒè¯­è¨€ï¼Œè¿™æ„å‘³ç€Rustçš„charå¹¶ä¸æ˜¯ 1 ä¸ªå­—èŠ‚ï¼Œè€Œæ˜¯ 4 ä¸ªã€‚

```rust
let x = 'x';
let two_hearts = 'ğŸ’•';
```

* å­—ç¬¦ä¸²ç±»å‹

Rust çš„ str ç±»å‹æ˜¯æœ€åŸå§‹çš„å­—ç¬¦ä¸²ç±»å‹ã€‚ä½œä¸ºä¸€ä¸ªä¸å®šé•¿ç±»å‹ï¼Œå®ƒæœ¬èº«å¹¶ä¸æ˜¯éå¸¸æœ‰ç”¨ï¼Œä¸è¿‡å½“å®ƒç”¨åœ¨å¼•ç”¨åæ˜¯å°±æœ‰ç”¨äº†ï¼Œä¾‹å¦‚`&str`ã€‚
å¯ä»¥è®¤ä¸º `&str` æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç‰‡æ®µï¼ˆstring sliceï¼‰ã€‚

```rust
let hello = "Hello, world!";

// with an explicit type annotation
let hello: &'static str = "Hello, world!";
```

#### å¤åˆç±»å‹

å¤åˆç±»å‹å¯ä»¥å°†å¤šä¸ªå…¶ä»–ç±»å‹çš„å€¼ç»„åˆæˆä¸€ä¸ªç±»å‹ã€‚Rust æœ‰ä¸¤ä¸ªåŸç”Ÿçš„å¤åˆç±»å‹ï¼šå…ƒç»„ï¼ˆtupleï¼‰å’Œæ•°ç»„ï¼ˆarrayï¼‰ã€‚

* æ•°ç»„

ä¸€ä¸ªå®šé•¿ç›¸åŒç±»å‹çš„å…ƒç´ åˆ—è¡¨ã€‚æ•°ç»„é»˜è®¤æ˜¯ä¸å¯å˜çš„ã€‚
å¯ä»¥ç”¨ä¸‹æ ‡ï¼ˆsubscript notationï¼‰æ¥è®¿é—®ç‰¹å®šçš„å…ƒç´ ï¼Œä¸‹æ ‡ä»0å¼€å§‹ã€‚

```rust
let a = [1, 2, 3]; // a: [i32; 3]
let mut m = [1, 2, 3]; // m: [i32; 3]

println!("a has {} elements", a.len());

let names = ["Graydon", "Brian", "Niko"]; // names: [&str; 3]

println!("The second name is: {}", names[1]);
```

æ•°ç»„çš„ç±»å‹æ˜¯`[T; N]`ï¼ŒNæ˜¯ä¸€ä¸ªç¼–è¯‘æ—¶å¸¸é‡ï¼Œä»£è¡¨æ•°ç»„çš„é•¿åº¦ã€‚

* åˆ‡ç‰‡ï¼ˆSlicesï¼‰

ä¸€ä¸ªåˆ‡ç‰‡ï¼ˆsliceï¼‰æ˜¯ä¸€ä¸ªæ•°ç»„çš„å¼•ç”¨ï¼ˆæˆ–è€…â€œè§†å›¾â€ï¼‰ã€‚å®ƒæœ‰åˆ©äºå®‰å…¨ï¼Œæœ‰æ•ˆçš„è®¿é—®æ•°ç»„çš„ä¸€éƒ¨åˆ†è€Œä¸ç”¨è¿›è¡Œæ‹·è´ã€‚æ¯”å¦‚ï¼Œä½ å¯èƒ½åªæƒ³è¦å¼•ç”¨è¯»å…¥åˆ°å†…å­˜çš„æ–‡ä»¶ä¸­çš„ä¸€è¡Œã€‚åŸç†ä¸Šï¼Œç‰‡æ®µå¹¶ä¸æ˜¯ç›´æ¥åˆ›å»ºçš„ï¼Œè€Œæ˜¯å¼•ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„å˜é‡ã€‚ç‰‡æ®µæœ‰é¢„å®šä¹‰çš„é•¿åº¦ï¼Œå¯ä»¥æ˜¯å¯å˜ä¹Ÿå¯ä»¥æ˜¯ä¸å¯å˜çš„ã€‚

åœ¨åº•å±‚ï¼Œslice ä»£è¡¨ä¸€ä¸ªæŒ‡å‘æ•°æ®å¼€å§‹çš„æŒ‡é’ˆå’Œä¸€ä¸ªé•¿åº¦ã€‚

ä½ å¯ä»¥ç”¨ä¸€ä¸ª&å’Œ[]çš„ç»„åˆä»å¤šç§æ•°æ®ç±»å‹åˆ›å»ºä¸€ä¸ªåˆ‡ç‰‡ã€‚

```rust
let a = [0, 1, 2, 3, 4];
let complete = &a[..]; // A slice containing all of the elements in `a`.
let middle = &a[1..4]; // A slice of `a`: only the elements `1`, `2`, and `3`.
let str_slice: &[&str] = &["one", "two", "three"];
```

* å…ƒç»„ï¼ˆTuplesï¼‰

å…ƒç»„æ˜¯ä¸€ä¸ªå°†å¤šä¸ªå…¶ä»–ç±»å‹çš„å€¼ç»„åˆè¿›ä¸€ä¸ªå¤åˆç±»å‹çš„ä¸»è¦æ–¹å¼ï¼Œæ˜¯å›ºå®šå¤§å°çš„æœ‰åºåˆ—è¡¨ã€‚
ä¸ºäº†ä»å…ƒç»„ä¸­è·å–å•ä¸ªçš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…ï¼ˆpattern matchingï¼‰æ¥è§£æ„ï¼ˆdestructure ï¼‰å…ƒç»„ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç‚¹å·`.`åè·Ÿå€¼çš„ç´¢å¼•æ¥ç›´æ¥è®¿é—®ä»–ä»¬ï¼Œä¸åƒæ•°ç»„ç´¢å¼•ä½¿ç”¨`[]`ã€‚

```rust
fn main() {
    let tup: (i32, f64, u8) = (500, 6.4, 1);
    let (x, y, z) = tup;
    println!("The value of y is: {}", y);

    let five_hundred = x.0;
    let six_point_four = x.1;
    let one = x.2;
}
```

ä½ å¯ä»¥æŠŠä¸€ä¸ªå…ƒç»„èµ‹å€¼ç»™å¦ä¸€ä¸ªï¼Œå¦‚æœå®ƒä»¬åŒ…å«ç›¸åŒçš„ç±»å‹å’Œæ•°é‡ã€‚å½“å…ƒç»„æœ‰ç›¸åŒçš„é•¿åº¦æ—¶å®ƒä»¬æœ‰ç›¸åŒçš„æ•°é‡ã€‚
```rust
let mut x = (1, 2); // x: (i32, i32)
let y = (2, 3); // y: (i32, i32)

x = y;
```

ä½ å¯ä»¥ä¸€ä¸ªé€—å·æ¥æ¶ˆé™¤ä¸€ä¸ªå•å…ƒç´ å…ƒç»„å’Œä¸€ä¸ªæ‹¬å·ä¸­çš„å€¼çš„æ­§ä¹‰ï¼š
```rust
(0,); // single-element tuple
(0); // zero in parentheses
```

## å‡½æ•°

fn è¡¨ç¤ºâ€œè¿™æ˜¯ä¸€ä¸ªå‡½æ•°â€ï¼Œåé¢è·Ÿç€åå­—ï¼Œä¸€å¯¹æ‹¬å·ï¼Œæ‹¬å·é‡Œæ˜¯å‚æ•°ï¼Œæœ€åæ˜¯ä¸€å¯¹å¤§æ‹¬å·ä»£è¡¨å‡½æ•°ä½“ã€‚
å‡½æ•°å‚æ•°ä¸letå£°æ˜éå¸¸ç›¸ä¼¼ï¼šå‚æ•°ååŠ ä¸Šå†’å·å†åŠ ä¸Šå‚æ•°ç±»å‹ã€‚
ä¸letä¸åŒï¼Œä½ å¿…é¡»ä¸ºå‡½æ•°å‚æ•°å£°æ˜ç±»å‹ã€‚

ä¸‹é¢è¿™ä¸ªå‡½æ•°æ‰“å°ä¸€ä¸ªæ•°å­—ï¼š

```rust
fn main() {
    print_number(5);
}

fn print_number(x: i32) {
    println!("x is: {}", x);
}
```

### å‡½æ•°è¿”å›å€¼

Rust å‡½æ•°åªèƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œå¹¶ä¸”ä½ éœ€è¦åœ¨ä¸€ä¸ªâ€œç®­å¤´â€`->` åé¢å£°æ˜ç±»å‹ã€‚
ä¸‹é¢è¿™ä¸ªå‡½æ•°ç»™ä¸€ä¸ªæ•´æ•°åŠ ä¸€ï¼š

```rust
fn add_one(x: i32) -> i32 {
    x + 1
}
```

æ³¨æ„è¿™é‡Œå¹¶æ²¡æœ‰ä¸€ä¸ªåˆ†å·ã€‚

### è¡¨è¾¾å¼ VS è¯­å¥

Rust ä¸»è¦æ˜¯ä¸€ä¸ªåŸºäºè¡¨è¾¾å¼çš„è¯­è¨€ã€‚åªæœ‰ä¸¤ç§è¯­å¥ï¼Œå…¶å®ƒçš„ä¸€åˆ‡éƒ½æ˜¯è¡¨è¾¾å¼ã€‚
Rust ä¸­æœ‰ä¸¤ç§ç±»å‹çš„è¯­å¥ï¼šâ€œå£°æ˜è¯­å¥â€å’Œâ€œè¡¨è¾¾å¼è¯­å¥â€ã€‚å…¶ä½™çš„ä¸€åˆ‡æ˜¯è¡¨è¾¾å¼ã€‚
è¡¨è¾¾å¼è¿”å›ä¸€ä¸ªå€¼ï¼Œè€Œè¯­å¥ä¸æ˜¯ã€‚

* å£°æ˜è¯­å¥

åœ¨ Rust ä¸­ï¼Œä½¿ç”¨letå¼•å…¥ä¸€ä¸ªç»‘å®šå¹¶ä¸æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚ä¸‹é¢çš„ä»£ç ä¼šäº§ç”Ÿä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ï¼š

```rust
let x = (let y = 5); // expected identifier, found keyword `let`
```
ç¼–è¯‘å™¨å‘Šè¯‰æˆ‘ä»¬è¿™é‡Œå®ƒæœŸæœ›çœ‹åˆ°è¡¨è¾¾å¼çš„å¼€å¤´ï¼Œè€Œletåªèƒ½å¼€å§‹ä¸€ä¸ªè¯­å¥ï¼Œä¸æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚
ä¸åƒå…¶å®ƒè¯­è¨€ä¸­èµ‹å€¼è¯­å¥è¿”å›å®ƒèµ‹çš„å€¼ï¼Œåœ¨ Rust ä¸­èµ‹å€¼çš„å€¼æ˜¯ä¸€ä¸ªç©ºçš„å…ƒç»„`()`ï¼š

```rust
let mut y = 5;
let x = (y = 6);  // `x` has the value `()`, not `6`.
```

* è¡¨è¾¾å¼è¯­å¥

å®ƒçš„ç›®çš„æ˜¯æŠŠä»»ä½•è¡¨è¾¾å¼å˜ä¸ºè¯­å¥ã€‚åœ¨å®è·µç¯å¢ƒä¸­ï¼ŒRust è¯­æ³•æœŸæœ›è¯­å¥åè·Ÿå…¶å®ƒè¯­å¥ã€‚è¿™æ„å‘³ç€ä½ ç”¨åˆ†å·æ¥åˆ†éš”å„ä¸ªè¡¨è¾¾å¼ã€‚
å‡½æ•°è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚å®è°ƒç”¨æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ã€‚æˆ‘ä»¬ç”¨æ¥åˆ›æ–°å»ºä½œç”¨åŸŸçš„å¤§æ‹¬å·`{}`ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼š

```rust
fn main() {
    let x = 5;

    let y = {
        let x = 3;
        x + 1
    };

    println!("The value of y is: {}", y);
}
```

åœ¨ä¸‹é¢ä»£ç ä¸­ï¼š

```rust
fn add_one(x: i32) -> i32 {
    x + 1
}
```

æˆ‘ä»¬çš„å‡½æ•°å£°ç§°å®ƒè¿”å›ä¸€ä¸ªi32ï¼Œä½†æ˜¯å¦‚æœåœ¨`x + 1`åå¸¦ä¸Šä¸ªåˆ†å·ï¼Œå®ƒå°±å˜æˆäº†è¯­å¥ï¼Œæœ€ç»ˆä¼šè¿”å›ä¸€ä¸ªç©ºçš„å…ƒç»„`()`ã€‚

### ææ—©è¿”å›ï¼ˆEarly returnsï¼‰

Rust æœ‰è¿™ä¹ˆä¸€ä¸ªå…³é”®å­— `return`ï¼š

```rust
fn foo(x: i32) -> i32 {
    return x;

    // we never run this code!
    x + 1
}
```

### å‘æ•£å‡½æ•°ï¼ˆDiverging functionsï¼‰

Rust æœ‰äº›ç‰¹æ®Šçš„è¯­æ³•å«â€œå‘æ•£å‡½æ•°â€ï¼Œè¿™äº›å‡½æ•°å¹¶ä¸è¿”å›ï¼Œå®ƒçš„è¿”å›å€¼ç±»å‹è®¾ç½®ä¸º`!`ä»£è¡¨å‘æ•£ï¼š

```rust
fn diverges() -> ! {
    panic!("This function never returns!");
}
```

`panic!`æ˜¯ä¸€ä¸ªå®ï¼Œä¼šå¯¼è‡´å½“å‰çš„æ‰§è¡Œçº¿ç¨‹å´©æºƒå¹¶è¿”å›æŒ‡å®šçš„ä¿¡æ¯ã€‚å› ä¸ºè¿™ä¸ªå‡½æ•°ä¼šå´©æºƒï¼Œæ‰€ä»¥å®ƒä¸ä¼šè¿”å›ï¼Œæ‰€ä»¥å®ƒæ‹¥æœ‰ä¸€ä¸ªè¿”å›ç±»å‹`!`ï¼Œå®ƒä»£è¡¨â€œå‘æ•£â€ã€‚

### å‡½æ•°æŒ‡é’ˆ

æˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ›å»ºæŒ‡å‘å‡½æ•°çš„å˜é‡ç»‘å®šï¼š

```rust
let f: fn(i32) -> i32;
```

f æ˜¯ä¸€ä¸ªæŒ‡å‘ä¸€ä¸ªè·å–i32ä½œä¸ºå‚æ•°å¹¶è¿”å›i32çš„å‡½æ•°çš„å˜é‡ç»‘å®šã€‚ä¾‹å¦‚ï¼š

```rust
fn plus_one(i: i32) -> i32 {
    i + 1
}

// without type inference
let f: fn(i32) -> i32 = plus_one;

// with type inference
let f = plus_one;

let six = f(5);
```
