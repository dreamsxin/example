

## 方法1：使用 `SCAN` 和管道 (推荐，适合生产环境)

```bash
# 扫描并删除，避免阻塞
redis-cli -h localhost -n dbindex -a YOUR_PASSWORD --scan --pattern "prefix:*" | xargs redis-cli -h localhost -n dbindex -a YOUR_PASSWORD DEL
```

或者分批删除（避免参数过长）：
```bash
redis-cli -a YOUR_PASSWORD --scan --pattern "prefix:*" | xargs -n 1000 redis-cli -a YOUR_PASSWORD DEL
```

## 方法2：使用 `KEYS` (谨慎使用，可能阻塞)

```bash
# 注意：KEYS 在生产环境可能阻塞 Redis
redis-cli -a YOUR_PASSWORD KEYS "prefix:*" | xargs redis-cli -a YOUR_PASSWORD DEL
```

## 方法3：使用 Lua 脚本 (原子操作，一次执行)

```bash
# 创建并执行 Lua 脚本
redis-cli -a YOUR_PASSWORD --eval del_keys_by_prefix.lua "prefix:" , 
```

**del_keys_by_prefix.lua** 内容：
```lua
local cursor = "0"
local pattern = ARGV[1] .. "*"
local count = 100  -- 每次扫描的数量
local keys = {}

repeat
    local result = redis.call("SCAN", cursor, "MATCH", pattern, "COUNT", count)
    cursor = result[1]
    local batch_keys = result[2]
    
    if #batch_keys > 0 then
        redis.call("DEL", unpack(batch_keys))
    end
until cursor == "0"
```

## 方法4：一行命令带认证

```bash
# 直接使用 AUTH 命令
redis-cli <<EOF
AUTH YOUR_PASSWORD
EVAL "local keys = redis.call('KEYS', ARGV[1]) for i=1,#keys,5000 do redis.call('DEL', unpack(keys, i, math.min(i+4999, #keys))) end return #keys" 0 "prefix:*"
EOF
```

## 方法5：使用 `--pipe` 管道模式

```bash
# 生成删除命令
redis-cli -a YOUR_PASSWORD --scan --pattern "prefix:*" | awk '{print "DEL "$0}' | redis-cli -a YOUR_PASSWORD --pipe
```

## 方法6：使用密码文件（更安全）

```bash
# 将密码保存到文件
echo "YOUR_PASSWORD" > /tmp/redis_pass

# 使用密码文件
redis-cli --pass $(cat /tmp/redis_pass) --scan --pattern "prefix:*" | xargs redis-cli --pass $(cat /tmp/redis_pass) DEL

# 清理密码文件
rm /tmp/redis_pass
```

## 方法7：交互式操作

```bash
redis-cli
AUTH YOUR_PASSWORD
# 然后执行删除
EVAL "local keys = redis.call('KEYS', 'prefix:*') for i=1,#keys,5000 do redis.call('DEL', unpack(keys, i, math.min(i+4999, #keys))) end return #keys" 0
```

## 注意事项：

1. **生产环境建议使用 `SCAN`**，因为 `KEYS` 会阻塞 Redis
2. 如果 key 数量很多，建议分批次删除
3. 使用 `-n` 参数指定数据库：
   ```bash
   redis-cli -a YOUR_PASSWORD -n 1 --scan --pattern "prefix:*" | xargs redis-cli -a YOUR_PASSWORD -n 1 DEL
   ```
4. 对于集群模式，需要在每个节点上执行

## 最安全的批量删除方案：

```bash
#!/bin/bash
PASSWORD="your_password"
PREFIX="prefix:"
COUNT=1000

# 分批次扫描删除
while true; do
    # 扫描一批 key
    keys=$(redis-cli -a "$PASSWORD" --scan --pattern "${PREFIX}*" --count $COUNT)
    
    # 如果没有更多 key，退出
    if [ -z "$keys" ]; then
        break
    fi
    
    # 删除这批 key
    echo "$keys" | xargs redis-cli -a "$PASSWORD" DEL
    
    # 可选：添加延迟避免过度负载
    sleep 0.1
done
```
