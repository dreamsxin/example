## 查看集群节点

```shell
./kafka-broker-api-versions.sh --bootstrap-server localhost:9092
```

## 查看所有主题

```shell
./kafka-topics.sh --bootstrap-server localhost:9092 --list
```

## 生产测试

```shell
kafka-console-producer.sh --bootstrap-server localhost:9092 --topic alarm
```

## 消费测试

```shell
kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic alarm
kafka-console-consumer.sh --bootstrap-server 10.0.0.222:9092,10.0.0.115:9092,10.0.0.200:9092 --topic alarm --group test-group --from-beginning
kafka-console-consumer.sh --bootstrap-server 10.0.0.222:9092,10.0.0.115:9092,10.0.0.200:9092 --topic crawl_logs --group test-group --from-beginning
```

## 查看消费者
```shell
kafka-consumer-groups.sh --bootstrap-server localhost:9092 --describe --group crawler-worker-group
```

## 查看指定主题消息

```shell
kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic crawler_tasks --from-beginning
```


## 重建主题

```shell
kafka-topics.sh \
  --bootstrap-server localhost:9092 \
  --delete \
  --topic crawl_logs

kafka-topics.sh \
  --bootstrap-server localhost:9092 \
  --delete \
  --topic search_log_topic_prod

# 列出所有消费者组
kafka-consumer-groups.sh --bootstrap-server localhost:9092 --list

# 查看特定消费者组的详细偏移量信息
kafka-consumer-groups.sh --bootstrap-server localhost:9092 \
  --group serp-log-group \
  --describe

kafka-consumer-groups.sh --bootstrap-server localhost:9092 \
  --group serp-log-group \
  --topic crawl_logs \
  --reset-offsets --to-latest \
  --execute
```

## Zookeeper

在Kafka的`bin`目录下，确实提供了几个用于管理**随Kafka发行版一同打包的ZooKeeper**的脚本。它们主要用于**开发测试或与Kafka深度集成的简单场景**。

> 注：自Kafka 3.0起，官方开始推荐使用不依赖ZooKeeper的**KRaft模式**。对于生产环境，强烈建议使用**独立的、高可用的ZooKeeper集群**。

这些脚本的主要用途和操作如下：

| 脚本文件 | 主要用途 | 典型场景与使用命令 |
| :--- | :--- | :--- |
| **`zookeeper-server-start.sh`** | **启动一个ZooKeeper服务器实例**。 | 启动：`./zookeeper-server-start.sh ../config/zookeeper.properties` |
| **`zookeeper-server-stop.sh`** | **停止ZooKeeper服务器实例**。 | 停止：`./zookeeper-server-stop.sh` |
| **`zookeeper-shell.sh`** | **启动一个ZooKeeper客户端命令行**，用于连接和交互。 | 连接：`./zookeeper-shell.sh localhost:2181` |

### 🔍 核心操作详解

**1. 使用 `zookeeper-shell.sh` 连接到集群**
这是**最实用的工具**，尤其在您之前遇到四字命令被禁用时，可以用它来检查和操作ZooKeeper中的数据。它会启动一个交互式命令行界面。

**基本使用：**
```bash
# 连接到本地或指定的ZooKeeper集群
./zookeeper-shell.sh localhost:2181
# 或者
./zookeeper-shell.sh zk1.example.com:2181
```
连接成功后，会进入 `zk:` 开头的提示符。您可以输入 `help` 查看所有可用命令。

**常用诊断命令（在zk shell内执行）：**
```
# 1. 查看根路径下的节点，通常可以看到Kafka注册的 /brokers 和 /consumers 等
ls /

# 2. 查看所有已注册的Kafka Broker ID（诊断节点是否注册成功）
ls /brokers/ids

# 3. 查看某个具体Broker的详细信息（IP、端口等）
get /brokers/ids/1

# 4. 查看Kafka集群的Controller（主节点）是哪个Broker
get /controller

# 5. 查看某个消费组的偏移量信息（如果使用旧版消费者API）
ls /consumers/your-consumer-group-name
```

**2. 启动/停止内嵌的ZooKeeper服务**
用于快速搭建一个包含Kafka和ZooKeeper的本地测试环境。

**启动服务（需指定配置文件）：**
```bash
# 通常使用Kafka自带的默认配置
./zookeeper-server-start.sh -daemon ../config/zookeeper.properties
# 使用 -daemon 参数在后台运行
```

**停止服务：**
```bash
./zookeeper-server-stop.sh
```

### 💡 结合您之前问题的实用诊断示例
针对您之前遇到的“只能从Leader消费”和“Coordinator Unavailable”问题，可以通过 `zookeeper-shell.sh` 快速验证：

```bash
# 1. 连接到ZooKeeper
./zookeeper-shell.sh your-zk-host:2181

# 2. 执行以下命令检查集群状态
# 检查所有Broker是否都已正确注册
ls /brokers/ids
# 输出应为所有Broker的ID列表，例如：[1, 2, 3]

# 3. 检查Controller（协调者选举的关键）是否正常
get /controller
# 输出会显示当前Controller的Broker ID

# 4. 检查您怀疑有问题的Topic的分区Leader选举状态
# 这通常在 /brokers/topics/your_topic_name 中，但更直接的方式还是使用kafka-topics.sh --describe
```

### ⚠️ 重要注意事项
1.  **生产环境警告**：这些脚本启动的是**单点ZooKeeper**，没有高可用性，**绝对不适用于生产环境**。
2.  **配置依赖**：`zookeeper-server-start.sh` 依赖于 `../config/zookeeper.properties` 配置文件。其中 `dataDir` 指定了数据存储目录，清理此目录会**丢失所有元数据**。
3.  **版本过渡**：如果您使用的是Kafka 3.x，尤其是3.3+版本，建议优先评估和迁移到**KRaft模式**，这是未来的方向。

### 📝 总结建议
对于运维和调试，**`zookeeper-shell.sh` 是您最需要掌握的脚本**。当四字命令不可用时，它是直接检查ZooKeeper内部状态的最佳替代方案。而对于服务的启停，请根据您的环境（测试/生产）决定是使用这些便捷脚本还是标准的系统服务管理命令。
