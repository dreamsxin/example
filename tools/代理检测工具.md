
- https://github.com/mubeng/mubeng

```sh
#!/bin/bash

# 颜色定义
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# 测试服务器列表
TEST_URLS=(
    "https://httpbin.org/ip"
    "https://api.ipify.org?format=json"
    "https://httpbin.org/user-agent"
    "https://httpbin.org/headers"
    "http://ip-api.com/json"
)

# 显示用法
usage() {
    echo "Usage: $0 [options]"
    echo ""
    echo "Options:"
    echo "  -h, --help                  Show this help message"
    echo "  -p, --proxy PROXY_URL       Proxy URL (http://proxy:port or socks5://proxy:port)"
    echo "  -u, --user USERNAME         Proxy username"
    echo "  -P, --password PASSWORD     Proxy password"
    echo "  -t, --timeout TIMEOUT       Request timeout in seconds (default: 10)"
    echo "  -f, --file FILE             File containing proxy list"
    echo "  -o, --output FILE           Output results to file"
    echo "  -v, --verbose               Verbose output"
    echo ""
    echo "Examples:"
    echo "  $0 -p http://proxy.example.com:8080"
    echo "  $0 -p socks5://proxy.example.com:1080 -u username -P password"
    echo "  $0 -f proxies.txt -o results.json"
    echo "  $0 -p http://proxy:8080 -v"
}

# 测试单个代理
test_proxy() {
    local proxy_url=$1
    local username=$2
    local password=$3
    local timeout=$4
    local verbose=$5
    
    echo -e "${BLUE}Testing proxy: $proxy_url${NC}"
    
    # 构建 curl 命令
    local curl_cmd="curl -s"
    
    # 添加超时
    curl_cmd="$curl_cmd --connect-timeout $timeout --max-time $timeout"
    
    # 添加代理设置
    if [[ $proxy_url == socks5* ]]; then
        if [[ -n "$username" && -n "$password" ]]; then
            curl_cmd="$curl_cmd --socks5 $proxy_url --proxy-user $username:$password"
        else
            curl_cmd="$curl_cmd --socks5 $proxy_url"
        fi
    else
        if [[ -n "$username" && -n "$password" ]]; then
            proxy_url=$(echo "$proxy_url" | sed "s|://|://$username:$password@|")
        fi
        curl_cmd="$curl_cmd --proxy $proxy_url"
    fi
    
    # 添加详细输出
    if [[ $verbose == "true" ]]; then
        curl_cmd="$curl_cmd -v"
    fi
    
    # 测试每个 URL
    local success_count=0
    local total_tests=${#TEST_URLS[@]}
    
    for test_url in "${TEST_URLS[@]}"; do
        echo -n "Testing $test_url ... "
        
        local start_time=$(date +%s%N)
        local response=$($curl_cmd "$test_url" 2>/dev/null)
        local end_time=$(date +%s%N)
        local duration=$(( (end_time - start_time) / 1000000 ))
        
        if [[ $? -eq 0 && -n "$response" ]]; then
            echo -e "${GREEN}✓${NC} (${duration}ms)"
            ((success_count++))
            
            # 显示 IP 信息
            if [[ $test_url == *"ip"* ]]; then
                local ip=$(echo "$response" | grep -oE '"ip"[[:space:]]*:[[:space:]]*"[^"]+"' | cut -d'"' -f4)
                if [[ -n "$ip" ]]; then
                    echo -e "  ${YELLOW}Detected IP: $ip${NC}"
                fi
            fi
        else
            echo -e "${RED}✗${NC}"
        fi
    done
    
    # 计算成功率
    local success_rate=$(( success_count * 100 / total_tests ))
    
    if [[ $success_rate -ge 80 ]]; then
        echo -e "${GREEN}✓ Proxy working: $success_rate% success rate${NC}"
        return 0
    else
        echo -e "${RED}✗ Proxy unreliable: $success_rate% success rate${NC}"
        return 1
    fi
}

# 批量测试代理
batch_test() {
    local proxy_file=$1
    local output_file=$2
    local timeout=$3
    
    if [[ ! -f "$proxy_file" ]]; then
        echo -e "${RED}Error: Proxy file not found: $proxy_file${NC}"
        return 1
    fi
    
    local results=()
    local proxy_count=0
    local working_count=0
    
    echo -e "${BLUE}Starting batch proxy test...${NC}"
    echo "Proxy file: $proxy_file"
    echo "Output file: $output_file"
    echo ""
    
    # 读取代理文件
    while IFS= read -r proxy || [[ -n "$proxy" ]]; do
        # 跳过空行和注释
        [[ -z "$proxy" || "$proxy" =~ ^# ]] && continue
        
        ((proxy_count++))
        
        # 解析代理格式
        if [[ "$proxy" =~ ^[^:]+:[0-9]+$ ]]; then
            # 格式: host:port
            proxy_url="http://$proxy"
        elif [[ "$proxy" =~ ^socks[45]:// ]]; then
            # 格式: socks5://host:port
            proxy_url="$proxy"
        elif [[ "$proxy" =~ ^http:// ]]; then
            # 格式: http://host:port
            proxy_url="$proxy"
        else
            # 未知格式，尝试作为 HTTP 代理
            proxy_url="http://$proxy"
        fi
        
        echo -e "${YELLOW}[$proxy_count] Testing: $proxy_url${NC}"
        
        # 测试代理
        if test_proxy "$proxy_url" "" "" "$timeout" "false"; then
            ((working_count++))
            results+=("{\"proxy\": \"$proxy_url\", \"status\": \"working\"}")
        else
            results+=("{\"proxy\": \"$proxy_url\", \"status\": \"failed\"}")
        fi
        
        echo ""
        
    done < "$proxy_file"
    
    # 输出摘要
    local success_rate=$(( working_count * 100 / proxy_count ))
    echo -e "${BLUE}=== Test Summary ===${NC}"
    echo -e "Total proxies:   $proxy_count"
    echo -e "Working proxies: $working_count"
    echo -e "Success rate:    $success_rate%"
    
    # 保存结果到文件
    if [[ -n "$output_file" ]]; then
        echo "[" > "$output_file"
        for ((i=0; i<${#results[@]}; i++)); do
            echo -n "  ${results[i]}" >> "$output_file"
            if [[ $i -lt $((${#results[@]} - 1)) ]]; then
                echo "," >> "$output_file"
            else
                echo "" >> "$output_file"
            fi
        done
        echo "]" >> "$output_file"
        echo -e "${GREEN}Results saved to: $output_file${NC}"
    fi
}

# 主函数
main() {
    local proxy_url=""
    local username=""
    local password=""
    local timeout=10
    local proxy_file=""
    local output_file=""
    local verbose="false"
    
    # 解析命令行参数
    while [[ $# -gt 0 ]]; do
        case $1 in
            -h|--help)
                usage
                exit 0
                ;;
            -p|--proxy)
                proxy_url="$2"
                shift 2
                ;;
            -u|--user)
                username="$2"
                shift 2
                ;;
            -P|--password)
                password="$2"
                shift 2
                ;;
            -t|--timeout)
                timeout="$2"
                shift 2
                ;;
            -f|--file)
                proxy_file="$2"
                shift 2
                ;;
            -o|--output)
                output_file="$2"
                shift 2
                ;;
            -v|--verbose)
                verbose="true"
                shift
                ;;
            *)
                echo -e "${RED}Unknown option: $1${NC}"
                usage
                exit 1
                ;;
        esac
    done
    
    # 批量测试模式
    if [[ -n "$proxy_file" ]]; then
        batch_test "$proxy_file" "$output_file" "$timeout"
        exit $?
    fi
    
    # 单个代理测试模式
    if [[ -z "$proxy_url" ]]; then
        echo -e "${RED}Error: Proxy URL is required${NC}"
        usage
        exit 1
    fi
    
    test_proxy "$proxy_url" "$username" "$password" "$timeout" "$verbose"
}

# 运行主函数
main "$@"
```
