## gops

gops is a command to list and diagnose Go processes currently running on your system.

- https://github.com/google/gops

```shell
go get -u github.com/google/gops
# or
go install github.com/google/gops@latest
```

### ğŸ“Š gops å¸¸ç”¨è¯Šæ–­å‘½ä»¤è¡¨

| å‘½ä»¤                          | åŠŸèƒ½æè¿°                                   | ç¤ºä¾‹å‚æ•°               |
|-------------------------------|-------------------------------------------|------------------------|
| `gops`                        | åˆ—å‡ºæ‰€æœ‰è¿è¡Œä¸­çš„ Go è¿›ç¨‹                  | æ— éœ€å‚æ•°               |
| `gops stats <pid>`            | æŸ¥çœ‹è¿è¡Œæ—¶ç»Ÿè®¡ï¼ˆCPU/å†…å­˜/GCï¼‰             | `gops stats 1234`     |
| `gops memstats <pid>`         | è¾“å‡ºè¯¦ç»†å†…å­˜åˆ†é…ä¿¡æ¯                      | `gops memstats 1234`  |
| `gops stack <pid>`            | è·å–æ‰€æœ‰ Goroutine çš„å †æ ˆè·Ÿè¸ª             | `gops stack 1234`     |
| `gops pprof-cpu <pid>`        | ç”Ÿæˆ CPU æ€§èƒ½åˆ†ææ–‡ä»¶ï¼ˆé»˜è®¤30ç§’ï¼‰         | `gops pprof-cpu 1234` |
| `gops pprof-heap <pid>`       | ç”Ÿæˆå †å†…å­˜å¿«ç…§                            | `gops pprof-heap 1234`|
| `gops trace <pid>`            | æ‰§è¡Œè·Ÿè¸ªå¹¶ç”Ÿæˆ `trace` æ–‡ä»¶               | `gops trace 1234`     |
| `gops gc <pid>`               | å¼ºåˆ¶è§¦å‘åƒåœ¾å›æ”¶ï¼ˆGCï¼‰                    | `gops gc 1234`        |
| `gops version <pid>`          | æŸ¥çœ‹ç›®æ ‡è¿›ç¨‹çš„ Go ç‰ˆæœ¬                    | `gops version 1234`   |

**gops**

æ˜¾ç¤ºæ‰€æœ‰è¿è¡Œä¸­çš„ Go è¿›ç¨‹ï¼ˆå¸¦ * æ ‡è¯†å·²é›†æˆ Agentï¼‰

#### ä½¿ç”¨è¯´æ˜ï¼š
1. æ›¿æ¢ `<pid>` ä¸ºç›®æ ‡è¿›ç¨‹çš„å®é™… IDï¼ˆé€šè¿‡ `gops` å‘½ä»¤è·å–ï¼‰
2. è¿œç¨‹è¯Šæ–­éœ€åœ¨ä»£ç ä¸­é…ç½® `agent.Options{Addr: "0.0.0.0:PORT"}`
3. ç”Ÿæˆçš„åˆ†ææ–‡ä»¶å¯ç”¨ `go tool pprof` å¯è§†åŒ–

#### è¿œç¨‹è¯Šæ–­
```shell
gops stats <è¿œç¨‹IP:PORT>  # è·å–è¿è¡Œæ—¶ç»Ÿè®¡:ml-citation{ref="3,8" data="citationList"}  
gops stack <è¿œç¨‹IP:PORT>  # æŸ¥çœ‹ Goroutine å †æ ˆ:ml-citation{ref="3,8" data="citationList"}
```

## go-torch

go-torch is deprecated, use pprof instead

-  github.com/uber/go-torch

## pprof

 ```go
package main

import (
	"net/http"
	"runtime/pprof"
	"time"
	"os"
)

func recordGoroutines() {
	f, _ := os.Create("goroutine_profile_" + time.Now().Format("20060102_150405") + ".pprof")
	defer f.Close()
	pprof.Lookup("goroutine").WriteTo(f, 1)
}

func main() {
	ticker := time.NewTicker(5 * time.Second)
	go func() {
		for range ticker.C {
			recordGoroutines()
		}
	}()

	// åŒæ—¶æä¾›HTTPæŸ¥è¯¢æ¥å£
	http.HandleFunc("/goroutines", func(w http.ResponseWriter, r *http.Request) {
		pprof.Lookup("goroutine").WriteTo(w, 1)
	})
	http.ListenAndServe(":8080", nil)
}
```
